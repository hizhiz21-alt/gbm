<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>グブ式会話ジェネレーター</title>

<style>
@font-face{
  font-family:"NewCinemaAStdD";
  src:url("./FOT-NewCinemaAStd-D.otf") format("opentype");
  font-display:swap;
}

html,body{
  height:100%;
  margin:0;
  background:#000;
  color:#fff;
  font-family:"NewCinemaAStdD", system-ui, -apple-system, "Noto Sans JP", sans-serif;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}

#stage{
  position:fixed;
  inset:0;
  overflow:hidden;
}

/* header */
#header{
  position:fixed;
  left:0; right:0; top:0;
  z-index:10;
  pointer-events:none;
}
#header img{ width:100%; height:auto; display:block; }

/* scene */
#scene{
  position:absolute;
  left:0; right:0; top:-60px;
  height:calc(100vh + 60px);
  overflow:hidden;
}
.bg{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  transform:scale(1.1);
}
.chara{
  position:absolute;
  left:50%;
  bottom:0;
  transform:translateX(-50%);
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  pointer-events:none;
}

/* ui */
.ui{
  position:fixed;
  left:0; right:0; bottom:0;
  padding-bottom:env(safe-area-inset-bottom);
}
.ui-scale{
  position:relative;
  left:50%;
  transform:translateX(-50%);
  width:640px;
}
.window-img{
  display:block;
  width:100%;
  height:auto;
}

/* text */
.name{
  position:absolute;
  left:38px;
  top:-4px;
  font-size:28px;
}
.text{
  position:absolute;
  left:48px;
  right:54px;
  top:76px;
  font-size:26px;
  line-height:1.55;
  white-space:pre-wrap;
}

.hint{
  position:absolute;
  right:28px;
  bottom:20px;
  animation:blink 1.2s infinite ease-in-out;
}
.hint img{ width:80px; margin-top:-8px; }

@keyframes blink{
  0%,100%{opacity:.3}
  50%{opacity:1}
}

.tap{
  position:fixed;
  inset:0;
  z-index:20;
}
</style>
</head>

<body>
<div id="stage">

  <div id="header">
    <img src="./header.png" alt="">
  </div>

  <div id="scene">
    <div class="bg" id="bg"></div>
    <img class="chara" id="chara" alt="">
  </div>

  <div class="ui">
    <div class="ui-scale">
      <!-- ★ メッセージウインドウ画像（自分用と同じ・1つ上） -->
      <img class="window-img" id="windowImg" src="../parts-sf4d7619aab.jpg" alt="">
      <div class="name" id="name">ランスロット</div>
      <div class="text" id="text"></div>
      <div class="hint" id="hint">
        <img src="../next.png" alt="next">
      </div>
    </div>
  </div>

  <div class="tap" id="tap"></div>
</div>

<script>
const elBg = document.getElementById("bg");
const elChara = document.getElementById("chara");
const elText = document.getElementById("text");
const elHint = document.getElementById("hint");

elBg.style.backgroundImage = 'url("../bg/temp.jpg")';
elChara.src = "./Lancelot.png";

const raw = `
あああ
---
いいい
`;

const lines = raw.trim().split("\n---\n");
let i = 0;
let typing = false;
let timer = null;

function show(idx){
  if(timer){ clearInterval(timer); }
  elText.textContent = "";
  elHint.style.display = "none";
  let t = lines[idx];
  let c = 0;
  typing = true;
  timer = setInterval(()=>{
    elText.textContent = t.slice(0, ++c);
    if(c >= t.length){
      clearInterval(timer);
      typing = false;
      elHint.style.display = "block";
    }
  }, 30);
}

function next(){
  if(typing){
    elText.textContent = lines[i];
    typing = false;
    elHint.style.display = "block";
    return;
  }
  i = (i+1)%lines.length;
  show(i);
}

show(0);
document.getElementById("tap").addEventListener("click", next);
</script>
</body>
</html>
